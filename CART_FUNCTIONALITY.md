# Функционал корзины и заказов

## Описание

Добавлен полный функционал корзины покупок и оформления заказов для интернет-магазина.

## Основные возможности

### Для пользователей:

1. **Добавление товаров в корзину**
   - На странице товара кнопка "Купить"
   - Для авторизованных пользователей открывается модальное окно с выбором количества
   - Для неавторизованных пользователей - pop-up с предложением авторизоваться
   - Можно выбрать количество товара (не больше, чем есть на складе)

2. **Просмотр корзины**
   - Иконка корзины в навигации (видна только авторизованным пользователям)
   - Счетчик товаров на иконке корзины
   - Страница корзины с полным списком товаров
   - Возможность изменить количество товара (+/-)
   - Возможность удалить товар из корзины

3. **Оформление заказа**
   - Кнопка "Оформить заказ" в корзине
   - Автоматическое создание заказа
   - Уменьшение количества товара на складе
   - Очистка корзины после оформления
   - Сообщение "Дождитесь, с вами свяжется оператор"

4. **Просмотр заказов**
   - Страница "Мои заказы" со списком всех заказов пользователя
   - Детальная страница каждого заказа
   - Информация о статусе заказа

### Для администраторов:

1. **Управление заказами в админ-панели**
   - Просмотр всех заказов
   - Изменение статуса заказа (Ожидает обработки, В обработке, Завершен, Отменен)
   - Просмотр товаров в заказе
   - Фильтрация по статусу и дате
   - Поиск по имени пользователя и email

2. **Управление корзинами**
   - Просмотр корзин всех пользователей
   - Просмотр товаров в корзине

## Модели

### Cart (Корзина)
- `user` - пользователь (OneToOne)
- `created_at` - дата создания
- `updated_at` - дата обновления

### CartItem (Товар в корзине)
- `cart` - корзина (ForeignKey)
- `product` - товар (ForeignKey)
- `quantity` - количество
- `added_at` - дата добавления

### Order (Заказ)
- `user` - пользователь (ForeignKey)
- `status` - статус заказа (pending, processing, completed, cancelled)
- `total_price` - общая стоимость
- `created_at` - дата создания
- `updated_at` - дата обновления

### OrderItem (Товар в заказе)
- `order` - заказ (ForeignKey)
- `product` - товар (ForeignKey)
- `quantity` - количество
- `price` - цена на момент заказа

## URL-маршруты

- `/cart/` - просмотр корзины
- `/cart/add/<product_id>/` - добавление товара в корзину (POST)
- `/cart/update/<item_id>/` - обновление количества товара (POST)
- `/cart/remove/<item_id>/` - удаление товара из корзины (POST)
- `/cart/checkout/` - оформление заказа (POST)
- `/orders/` - список заказов пользователя
- `/orders/<order_id>/` - детали заказа

## Применение миграций

После запуска Docker контейнеров выполните:

```bash
docker compose exec web python src/manage.py migrate
```

Или если используете Railway/другой хостинг, миграции применятся автоматически при деплое.

## Особенности реализации

1. **Проверка наличия товара** - при добавлении в корзину и оформлении заказа проверяется наличие товара на складе
2. **Транзакционность** - оформление заказа выполняется в транзакции для целостности данных
3. **Сохранение цены** - в заказе сохраняется цена товара на момент покупки
4. **Автоматическое уменьшение склада** - при оформлении заказа количество товара на складе уменьшается автоматически
5. **Модальные окна** - красивые модальные окна для выбора количества и уведомления о необходимости авторизации
6. **Счетчик корзины** - динамический счетчик товаров в корзине на всех страницах

## Статусы заказов

- **pending** (Ожидает обработки) - заказ только что создан
- **processing** (В обработке) - оператор обрабатывает заказ
- **completed** (Завершен) - заказ выполнен
- **cancelled** (Отменен) - заказ отменен

Администратор может изменять статус заказа в админ-панели.
